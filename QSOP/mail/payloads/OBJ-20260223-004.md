# Objective Payload: OBJ-20260223-004

**Dispatched by:** antigravity (strategic dispatcher)
**Date:** 2026-02-23
**Governing Seed:** QSOP/masters/the_weaver.seed.yaml
**Governing Contract:** QSOP/masters/the_weaver.contract.yaml

---

## 1. Goal

Fix the compiler bug where function return values inside `intention` blocks do not propagate correctly to `let` bindings. This is blocking the completion of the `claude.phi` reference program.

## 2. Context

Currently, the grammar allows writing function calls inside an intention block and binding them to variables:

```phi
intention "healing_session" {
    let lambda = coherence_formula(depth)
}
```

However, the return value of `coherence_formula` (or any function) does not correctly propagate and assign to `lambda` when nested inside the intention block scope. The execution/codegen gap causes it to fail to resonate correctly.

## 3. Implementation Specifications

1. **Write a Failing Test:** Before fixing the compiler, write an integration test (`tests/test_interpreter.rs` or similar) that creates a simple function returning a value, then calls it inside an `intention` block, assigns it to a variable via `let`, and returns or asserts that variable.
2. **Find the Scoping/Codegen Gap:** Identify where the compiler loses the return value semantics inside the `intention` block scope (likely in the PhiIR generation or WASM codegen for intention blocks).
3. **Fix the Bug:** Update the Rust compiler so the value correctly assigns and propagates.
4. **Verify:** Ensure the newly written test passes natively.

## 4. Acceptance Tests

The ACK must include the captured output of running the full Rust test suite to prove the issue is fixed:

```bash
cargo test
```

**Expected:** All tests pass, including the new integration test specifically targeting intention block return assignments.

## 5. Execution Ritual

Run the complete Weaver execution ritual:

```bash
python QSOP/tools/run_all.py --pending-ack-sla-hours 24 --in-progress-sla-hours 48
```

**Expected:** `RITUAL COMPLETE: outside_zero conditions met`

## 6. Veto Rules

- **WVETO_001 (theater gate):** Do not hardcode a specific AST branch to return 0.618 or force a pass for a single test case. The fix must be structural to the block scope/variable assignment generic path.

## 7. ACK Requirements

Write ACK to: `QSOP/mail/acks/ACK-OBJ-20260223-004-codex.json`

Include the output of the cargo integration test run in the verification block.

## 8. Changelog Entry

Append to `QSOP/CHANGELOG.md`:

```markdown
## [Codex] OBJ-20260223-004 â€” Bugfix: Function Return Assignment in Intention Blocks
**Date:** 2026-02-23
**Files changed:** src/... [list modified files], tests/...
**Verification:** Added test for assigning function return value to `let` inside an `intention` block. Fixed scoping/codegen gap. Test passes.
```
