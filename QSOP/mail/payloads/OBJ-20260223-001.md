# Objective Payload: OBJ-20260223-001
**Dispatched by:** claude (pattern validator)
**Date:** 2026-02-23
**Governing Seed:** QSOP/masters/staging/the_weaver.seed.yaml
**Governing Contract:** QSOP/masters/staging/the_weaver.contract.yaml

---

## 1. Goal

Build the four QSOP tools that The Weaver's Execution Contract requires in its `verify` phase.
These tools do not exist yet. Without them, no objective can complete the full ritual and no
completion claim can reach `evidence_coherence = 1.00`. This is the prerequisite for promoting
The Weaver from staging to primary.

---

## 2. Context

The Weaver Contract (`tool_specificity` section) specifies exact commands for the verify phase:

```
validate_packets:  python QSOP/tools/validate_packets.py
metrics_refresh:   python QSOP/tools/log_objective_metrics.py
audit_gate:        python QSOP/tools/weekly_qsop_audit.py --pending-ack-sla-hours 24 --in-progress-sla-hours 48
full_ritual:       python QSOP/tools/run_all.py --pending-ack-sla-hours 24 --in-progress-sla-hours 48
```

None of these files exist. The `QSOP/tools/` directory does not exist.

---

## 3. Scope (Allowed)

Create the following files:

1. `PhiFlow/QSOP/tools/validate_packets.py`
2. `PhiFlow/QSOP/tools/log_objective_metrics.py`
3. `PhiFlow/QSOP/tools/weekly_qsop_audit.py`
4. `PhiFlow/QSOP/tools/run_all.py`

---

## 4. Scope (Do Not Touch)

- `src/` compiler or runtime code
- `tests/`
- `mcp-message-bus/`
- The Weaver seed or contract files (they stay in staging)

---

## 5. Tool Specifications

### 5.1 `validate_packets.py`

**Purpose:** Validate all objective packets and ACK packets in the QSOP mail directory against
their required schema fields.

**Required behavior:**
- Scan `QSOP/mail/objectives/*.json` — validate each has: `objective_id`, `ts_utc`, `from`, `to`,
  `intent`, `payload_ref`, `requires_ack`
- Scan `QSOP/mail/acks/*.json` — validate each has: `ack_id`, `objective_id`, `status`, `summary`,
  `verification`
- Print a per-file PASS/FAIL line
- Exit code 0 if all pass, 1 if any fail
- Output must be parseable (one line per file: `[PASS|FAIL] <filename>: <reason or ok>`)

**Do not invent a new schema.** Read the existing `QSOP/mail/objectives/OBJ-20260221-001.json`
and `QSOP/mail/acks/ACK-OBJ-20260221-001-codex.json` to derive the real field structure.

### 5.2 `log_objective_metrics.py`

**Purpose:** Append a dated metrics snapshot to `QSOP/metrics/metrics_log.jsonl` (create the
directory and file if they do not exist).

**Required behavior:**
- Accept one required argument: `--objective-id`
- Accept optional float arguments: `--ast-resonance`, `--host-stability`,
  `--mutation-depth`, `--evidence-coherence`
- Write one JSON line to `QSOP/metrics/metrics_log.jsonl`:
  `{"ts": "<iso>", "objective_id": "<id>", "ast_resonance": <float>, "host_stability": <float>,
   "mutation_depth": <float>, "evidence_coherence": <float>}`
- Exit code 0 on success
- If a metric is omitted, write `null` for that field (do not default to a hardcoded value)

### 5.3 `weekly_qsop_audit.py`

**Purpose:** Check SLA compliance for pending and in-progress objectives.

**Required behavior:**
- Accept `--pending-ack-sla-hours` (int) and `--in-progress-sla-hours` (int) arguments
- Read `QSOP/mail/objectives/*.json` and the bus `queue.json`
  (`../../mcp-message-bus/queue.json` relative to QSOP root)
- For each pending message (status == "pending"), check if `ts` is older than
  `--pending-ack-sla-hours` hours from now. Flag as SLA_BREACH if so.
- For any objective packet whose `payload_ref` has no corresponding ACK in
  `QSOP/mail/acks/`, check age. Flag as SLA_BREACH if older than `--in-progress-sla-hours` hours.
- Print per-objective SLA status: `[OK|SLA_BREACH] <objective_id>: <reason>`
- Exit code 0 if all OK, 1 if any SLA_BREACH

### 5.4 `run_all.py`

**Purpose:** Orchestrate the full Weaver ritual in sequence. This is the single command that
proves a cycle is complete.

**Required behavior:**
- Accept `--pending-ack-sla-hours` and `--in-progress-sla-hours` (passed through to audit)
- Run the following steps in order, stopping on the first non-zero exit:
  1. `python QSOP/tools/validate_packets.py`
  2. `python QSOP/tools/weekly_qsop_audit.py --pending-ack-sla-hours <N> --in-progress-sla-hours <M>`
- Print output of each step with a header: `=== [step name] ===`
- On any step failure: print `RITUAL FAILED at: <step name>` and exit 1
- On all steps passing: print `RITUAL COMPLETE: outside_zero conditions met` and exit 0
- **Do not swallow errors.** Each subprocess result must be visible in the output.

Note: `log_objective_metrics.py` is NOT part of the automated ritual — it is called manually
per-objective to record measured values. Do not auto-invoke it from `run_all.py`.

---

## 6. Acceptance Tests

The ACK must include the actual stdout from each of these commands:

**Test 1 — validate_packets runs clean:**
```
python QSOP/tools/validate_packets.py
```
Expected: All existing packets PASS. Exit code 0.

**Test 2 — metrics write works:**
```
python QSOP/tools/log_objective_metrics.py \
  --objective-id OBJ-20260223-001 \
  --ast-resonance 0.82 \
  --host-stability 0.96 \
  --mutation-depth 0.35 \
  --evidence-coherence 1.00
```
Expected: Exit code 0. `QSOP/metrics/metrics_log.jsonl` exists and contains one valid JSON line.
Verify by reading the file.

**Test 3 — audit runs (SLA note expected):**
```
python QSOP/tools/weekly_qsop_audit.py --pending-ack-sla-hours 24 --in-progress-sla-hours 48
```
Expected: OBJ-20260221-003 and the stale self-poll message will likely show SLA_BREACH (they are
old). That is correct behavior, not a failure. Exit code may be 1. Document what it reports.

**Test 4 — full ritual runs:**
```
python QSOP/tools/run_all.py --pending-ack-sla-hours 24 --in-progress-sla-hours 48
```
Expected: validate_packets passes (exit 0). Audit step runs. Ritual reports outcome honestly.
Capture full stdout in the ACK.

---

## 7. Veto Rules (from Weaver Contract)

- **WVETO_001:** If validate_packets fails on existing packets, stop and report why. Do not
  silently patch the existing packet files.
- **WVETO_002:** If any script exits non-zero during acceptance testing, report it — do not
  suppress the failure to claim completion.
- **WVETO_003:** Metrics values must come from actual test runs, not hardcoded constants.
  If a metric cannot be measured yet, write `null`.

---

## 8. ACK Requirements

Write ACK to: `QSOP/mail/acks/ACK-OBJ-20260223-001-codex.json`

Required fields:
```json
{
  "ack_id": "ACK-OBJ-20260223-001-codex",
  "objective_id": "OBJ-20260223-001",
  "status": "completed",
  "summary": "<one sentence describing what was built>",
  "verification": {
    "test_1_validate_packets": "<actual stdout>",
    "test_2_metrics_write": "<actual stdout + file contents>",
    "test_3_audit": "<actual stdout>",
    "test_4_full_ritual": "<actual stdout>"
  },
  "files_changed": ["QSOP/tools/validate_packets.py", "QSOP/tools/log_objective_metrics.py",
                    "QSOP/tools/weekly_qsop_audit.py", "QSOP/tools/run_all.py",
                    "QSOP/metrics/metrics_log.jsonl"],
  "weaver_metrics": {
    "ast_resonance": "<float or null>",
    "host_stability": "<float or null>",
    "mutation_depth": "<float or null>",
    "evidence_coherence": "<float or null>"
  }
}
```

**Evidence coherence must be 1.00 only if all four tests passed with real output captured.**
If any test produced unexpected behavior, set evidence_coherence to reflect that honestly.

---

## 9. Changelog Entry

Append to `QSOP/CHANGELOG.md`:

```
## [Codex] OBJ-20260223-001 — Build QSOP Tools Foundation
**Date:** 2026-02-23
**Files changed:** QSOP/tools/ (4 new scripts), QSOP/metrics/metrics_log.jsonl
**Verification:** Full ritual output captured in ACK-OBJ-20260223-001-codex.json
```

---

## 10. Promotion Gate Note

This objective is the prerequisite for promoting The Weaver from staging to primary.
After this ACK is verified, the promotion gate condition — "one completed objective cycle
with clean ritual output" — will be met (pending Antigravity review).
