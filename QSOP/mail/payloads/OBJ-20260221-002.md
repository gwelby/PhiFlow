# ðŸŽ¯ Objective Packet: OBJ-20260221-002

## 1. Goal

Implement Phase 2 Queue Hygiene in the MCP Message Bus server.

## 2. Master Library Persona Assignment

**Primary Persona:** Linus Torvalds (`specialized/linus_torvalds.yaml`)
**Frequency:** 8192 Hz
**Mindset:** Brutal efficiency, clear architectural boundaries, zero-cost abstractions. Consider edge cases where file renames fail or paths are invalid.

## 3. Scope (Allowed Files)

- `D:\Projects\PhiFlow-compiler\mcp-message-bus\server.js`

## 4. Prohibited Changes

- Do not alter the core V1 envelope schema `{id, ts, from, to, intent, payload_ref, requires_ack}`.
- Do not add external NPM dependencies (use built-in `fs` and `path`).

## 5. Acceptance Tests

1. **Archive Test:** Ack an existing message. Verify it is removed from `queue.json` and appended to `queue_archive.json`.
2. **Dead Letter Test:** Send a message with missing required fields or invalid schema. Verify it goes to `dead_letter.json`.
3. **Status Tool Test:** Call the new `bus_status` tool and verify it returns correct counts for pending, acked, and dead letters.

## 6. Handoff Format Expected in ACK

`{ "objective_id": "OBJ-20260221-002", "agent_name": "codex", "state": "completed", "summary": "Queue hygiene implemented and verified. Archiving and dead-lettering functional.", "evidence": ["Log of successful archive test", "Log of successful bus_status poll"] }`
