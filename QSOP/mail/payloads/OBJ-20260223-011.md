# Objective Payload: OBJ-20260223-011

**Dispatched by:** claude (pattern validator)
**Date:** 2026-02-23
**Lane:** D — UniversalProcessor Codex
**Phase:** 10

---

## 1. Goal

Update the Resonance Matrix to show live stream cycle output when a healing bed program is running. Greg should see the stream converging in the same terminal where the swarm state lives.

---

## 2. Current State

`resonance_matrix.py` polls CHANGELOG files and shows last actions. It is static — it shows what happened, not what is happening right now.

---

## 3. New Feature: Live Stream Panel

When `run_phi.py --stream-output` is running (Lane B, OBJ-009), it emits newline-delimited JSON to stdout. The Resonance Matrix should optionally read this stream and show a live panel.

### Option A — File-based (simpler, no subprocess)

`run_phi.py --stream-output` writes to a known file:

```
/tmp/phiflow_stream_latest.jsonl
```

Resonance Matrix polls this file and shows the last N lines as a "LIVE STREAM" panel below the agent table.

### Option B — Subprocess (more direct)

Resonance Matrix spawns `run_phi.py --stream-output` as a subprocess and reads its stdout line by line.

**Use Option A.** It's simpler, decoupled, and doesn't require the Matrix to manage subprocess lifecycle.

---

## 4. Implementation

### In `run_phi.py` (coordinate with Lane B)

When `--stream-output` is active, also write each JSON event to:

```python
STREAM_LOG = Path("/tmp/phiflow_stream_latest.jsonl")
```

Overwrite the file each run (don't append).

### In `resonance_matrix.py`

Add a `--live-stream` flag. When active:

1. After the agent table, check if `/tmp/phiflow_stream_latest.jsonl` exists and was modified in the last 60 seconds.
2. If yes, read the last 5 lines and render a "LIVE STREAM" panel:

```
[LIVE STREAM]  healing_bed  (last updated: 2s ago)
+-------+------------+----------+--------+
| CYCLE | RESONANCE  | COHERENCE| STATUS |
+-------+------------+----------+--------+
|     1 | 0.4230     | 0.4230   | running|
|     2 | 0.6510     | 0.6510   | running|
|     3 | 0.7120     | 0.7120   | broken |
+-------+------------+----------+--------+
```

1. If no recent file, show: `[LIVE STREAM]  no active stream`

---

## 5. Required Tests (fail-first)

```python
def test_live_stream_panel_renders_when_file_present(tmp_path):
    """Matrix shows LIVE STREAM panel when /tmp/phiflow_stream_latest.jsonl exists."""
    stream_file = tmp_path / "stream.jsonl"
    stream_file.write_text(
        '{"cycle":1,"resonance":0.42,"coherence":0.42,"status":"running"}\n'
        '{"cycle":2,"resonance":0.65,"coherence":0.65,"status":"broken"}\n'
    )
    output = render_matrix(stream_log=stream_file)
    assert "LIVE STREAM" in output
    assert "0.42" in output

def test_live_stream_panel_absent_when_no_file():
    """Matrix shows 'no active stream' when file missing."""
    output = render_matrix(stream_log=Path("/tmp/does_not_exist_xyz.jsonl"))
    assert "no active stream" in output
```

---

## 6. Files Changed

| File | Action |
|------|--------|
| `/mnt/d/Projects/ResonanceMatrix/resonance_matrix.py` | ADD `--live-stream` flag + panel |
| `/mnt/d/Projects/ResonanceMatrix/tests/test_resonance_matrix.py` | CREATE — 2 tests |

**Coordinate with:** Lane B (OBJ-009) writes to `/tmp/phiflow_stream_latest.jsonl`.
**Do NOT touch:** PhiFlow Rust source, run_phi.py internals, QSOP tools.

---

## 7. Acceptance Criteria

1. Both tests fail before implementation, pass after.
2. `python resonance_matrix.py --watch --interval 30 --live-stream` shows the LIVE STREAM panel.
3. When no stream is running, shows "no active stream" cleanly.
4. Existing Resonance Matrix output (agent table) unchanged.

---

## 8. ACK to: `QSOP/mail/acks/ACK-OBJ-20260223-011-codex.json`
